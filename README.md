# XdUnityUI

![introduction](https://github.com/itouh2-i0plus/XdUnityUI/raw/develop/Documents/Media/introduction.gif)

## 概要

- AdobeXD のアートボードを Unity 用 UI Prefab にコンバートします

## クイックスタート

### Git リポジトリをクローン

- https://github.com/itouh2-i0plus/XdUnityUI
  - LFS を利用しています。Git クライアントによっては設定が必要となります。

### Unity プロジェクトを開く

- Unity2019.3、UniversalRenderPipeline のプロジェクトとなっています

### AdobeXD プラグインインストール

### AdobeXD 用サンプルファイルを開く

### AdobeXD からプラグイン起動

### Unity で動作確認

- できた Prefab を Canvas 以下に配置

## 動作条件

- Windows で開発しています
  - Mac での動作確認は現在不十分です
- Unity2019.3 で開発しています
- AdobeXD は最新版でテストしています
  - バージョン：27.1.12.4

## コンバートについて

### 概要

- AdobeXD 上でつけたノード名に対して、コンバートルールが適応される
  - コンバートルールは CSS の記述によって定義されている
  - json ファイルと画像ファイルが出力される
- 出力ファイルを Unity プロジェクト、XdUnityUI/Import フォルダに書き込むことで Unity でのコンバート処理が行われる
- 指定されたフォルダに Prefab と、Sprite が出力される

### ルール説明

## 問題が起こったとき

- Xd プラグイン

  - コンバート中に失敗・中断され、再度エクスポートしたが、コンバート処理が実行されない

    - 原因

      - 失敗したファイルへの上書きでは、Unity 側がファイルの更新を検知できないため

    - 対応
      - XdUnityUI/Import 内の\_XdUnityUIImport、\_XdUnityUIImport.meta ファイル以外を削除する
      - もう一度エキスポートする

  - 画像の書き出しに失敗する
    - 原因
      - AdobeXD 上の問題かもしれません。調査中です。
    - 対策
      1. ノードを選択し画像出力の操作をする。
      2. 出力先に XdUnityUI/Import フォルダを選択すると、出力不可になっているか確認。
      3. フォルダを変えて画像出力。
      4. 再度 Import フォルダに出力する。
      5. 上記が成功した場合、プラグインからの出力も成功するようになります。

- Unity コンバータ
  - 文字(Text、TextMeshPro)を扱おうとするとコンバートに失敗する
    - 原因
      - フォントが無い可能性があります
    - 対策
      - Console に探そうとして見つからなかったフォントファイル名が出力されます
      - フォントファイルを場合によってはリネームして、XdUnityUI/Fonts ディレクトリ(\_XdUnityUIFonts ファイルがおいてあるディレクトリ)にコピーしてください。
  - レスポンシブパラメータが正確にコンバートされない
    - 原因
      - XD プラグイン実行時、アートボードのサイズを変更しノードのサイズの変化をみてレスポンシブパラメータを取得しています。その際、リピードグリッド内ノード等、サイズが変わらないものはレスポンシブパラメータが確定できません。
    - 対策
      - margin-fix プロパティをつかい、明示的に指定する。
        - 例: start-button {margin-fix: t b l r}

## より使いこなすために

### オリジナル変換ルール

- 追記予定

### コンバート時に自作コンポーネントを追加する

- 追記予定

### 9Slice

- 追記予定

## 今後進む方向

- 目標
  - リリースまで AdobeXD で UI デザインできるようにする。
- メリット
  - デザイナの手に最終版をもたせる
  - CCLibrary を使い、各種ツールとの連携ができる
- 課題
  - コンバートでの Prefab 上書きによって、Prefab に対して行った作業(Unity 上で行ったコンポーネント追加、パラメータ調整)が消えてしまう
    - 対応策
      - コピーして使用する。
      - Prefab Variant で、追加作業の退避。
        - 名前の変更で作業が消えてしまう。
        - Variant ファイル内には作業分残っている模様(これを復帰できないか調査中)。
  - 同じ Sprite 画像が大量にできてしまう。
    - 対応策
      - Sprite 画像を比較して、同じであれば結合するツールを開発中。
  - 9Slice
    - 対応中
- その他
  - 調査中
    - UXML へコンバートできないか。
    - DOTS モード用 UI が作成できないか。

## 謝辞

- @kyubuns 様 (https://kyubuns.dev)
- Baum2 (https://github.com/kyubuns/Baum2)

### お世話になっております　ありがとうございます
